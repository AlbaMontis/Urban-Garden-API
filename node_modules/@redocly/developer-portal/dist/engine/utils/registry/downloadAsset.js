const fs=require("fs-extra"),path=require("path"),{downloadFileWithRetries}=require("./http"),{SIDEBARS_FILE_NAME,CONFIG_FILE_NAME}=require("../../plugins/gatsby-source-redocly-filesystem/utils");function downloadAsset({link:a,contentDir:b,directory:c,headers:d,reporter:e,downloadOnlyOpenapi:f}){const g="/"===c?path.resolve(b):path.resolve(b,c),h=decodeURIComponent(a.substring(a.lastIndexOf("/")+1));let i=path.resolve(g,h);const j=path.relative(b,i);i.includes("?branch=")&&(i=i.split("?branch=")[0]);const k=path.basename(i);if("/"===c&&[SIDEBARS_FILE_NAME,CONFIG_FILE_NAME].includes(k))return Promise.reject(new Error(`Root '${k}' file cannot be overridden. Please make sure, that 'directory' property in 'catalog' for "${a}" is not '/'`));if(fs.existsSync(i)&&(e.verbose(`File ${j} already exist, skip...`),"true"===process.env.WORKFLOWS))return Promise.reject(new Error("You have committed files which are controlled by registry assets. Please remove them from git in order to proceed."));const l={link:a,fileAbsolutePath:i,headers:d,reporter:e,downloadOnlyOpenapi:f,contentDir:b};return downloadFileWithRetries(l)}module.exports={downloadAsset};