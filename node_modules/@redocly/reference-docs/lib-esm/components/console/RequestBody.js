var _this=this;import{__assign,__awaiter,__generator,__rest}from"tslib";import*as React from"react";import{useEffect}from"react";import{observer}from"mobx-react";import merge from"deepmerge";import{DropdownOrLabel,MediaTypesSwitch}from"../../redoc-lib";import CodemirrorInput from"./CodemirrorInput";import{RequestMimeLabel}from"./RequestMimeLabel";import{ExampleSwitch,useExampleKey}from"../Samples";import{arrayMergeStrategy}from"../../services/utils";import{RequestBodyForm}from"./RequestBodyForm";import{isRootFileUpload}from"../common/FileUpload/helper";import{MediaTypes}from"../../models";import{Dropdown}from"../common/Dropdown";export var RequestBody=observer((function(e){var r,t=e.properties,o=void 0===t?{}:t,a=__rest(e,["properties"]),i=a.body.content,n=a.console.formApi,l=function(e){var r;if(!i||!i.hasSample)return"";var t=null===(r=i.active)||void 0===r?void 0:r.examples;if(!(null==t?void 0:t[e]))return"";var a=merge(null==t?void 0:t[e].value,o,{arrayMerge:arrayMergeStrategy});return JSON.stringify(a,null,2)},m=null===(r=null==i?void 0:i.operation)||void 0===r?void 0:r.activeExampleName,d=function(e){var r;null===(r=null==i?void 0:i.operation)||void 0===r||r.activateExampleName(e),n.setValue("body",l(e))},u=function(e){if(!e)return"";if("application/x-www-form-urlencoded"===e.mime)return e.value;var r=merge(e.value,o,{arrayMerge:arrayMergeStrategy});return JSON.stringify(r,null,2)},p=function(e,r){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(t){return(0,n.setValue)("body."+e,r),[2]}))}))};useEffect((function(){!1!==m?m&&n.setValue("body",l(m)):n.setValue("body",JSON.stringify(o,null,2))}),[m]);var s=a.validate,c=a.body;return React.createElement(React.Fragment,null,React.createElement(MediaTypesSwitch,{content:c.content,renderDropdown:function(e){return React.createElement(DropdownOrLabel,__assign({},e,{variant:"dark",fullWidth:!0,Label:RequestMimeLabel,Dropdown:Dropdown}))}},(function(e){var r,t=e.examples||{},o=Object.keys(t),i=e.schema,l=isRootFileUpload(i||{},e.name)||e.name===MediaTypes.MULTIPART||e.name===MediaTypes.URL_ENCODED,m=useExampleKey(e.operation,t).exampleKey,c=t[m];return React.createElement(React.Fragment,null,o.length&&1!==o.length&&React.createElement(ExampleSwitch,{examples:t,onChange:d,exampleKey:m})||null,l?React.createElement(RequestBodyForm,{mediaType:e,formApi:n,onChange:p.bind(_this)}):React.createElement(CodemirrorInput,{id:"body"+a.id,field:"body",initialValue:u(c),schema:((null===(r=null==a?void 0:a.resolvedBody)||void 0===r?void 0:r.content[e.name])||{}).schema,mode:e.name,validate:s}))})))}));
//# sourceMappingURL=RequestBody.js.map