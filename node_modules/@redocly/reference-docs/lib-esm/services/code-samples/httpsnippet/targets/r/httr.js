import{__assign}from"tslib";import{CodeBuilder}from"../../helpers/code-builder";import{buildUrlExpression,printUrlVariablesDeclarations}from"../../helpers/code-helpers";import{Lang}from"../../helpers/constants";import{HTTPSnippet}from"../..";import{normalizeMimeType}from"../../../../utils";import{postDataToRListBody,objectToRString}from"./utils";var indent=1,contentType={X_FORM_URLENCODED:"application/x-www-form-urlencoded",JSON:"application/json",FORM_DATA:"multipart/form-data"},handler=function(a,e,t){var r,s,o,n,i,l=t.target,p=t.client,d=Object.assign({indent:"  ",showBoilerplate:!0,printBody:!0},e),u=new CodeBuilder({indentation:d.indent,variablesPrefix:d.variablesPrefix,lang:Lang.R}),h=a.method.toUpperCase(),c=null===(r=a.securityOAuth2ExtraCalls)||void 0===r?void 0:r[0];if(d.showBoilerplate&&u.push("library(httr)").blank(),c){var b="oauth2_",m=new HTTPSnippet(c).convert(l,p,__assign(__assign({},d),{variablesPrefix:b,showBoilerplate:!1}));u.push(m).push('access_token = content(oauth2_data_req, "parsed")$access_token').blank(),a.allHeaders.Authorization='paste("Bearer", access_token)'}var v="";if(null==a?void 0:a.postData)switch(normalizeMimeType(null===(s=null==a?void 0:a.postData)||void 0===s?void 0:s.mimeType)){case contentType.X_FORM_URLENCODED:i="form",v=u.var("body");var y=postDataToRListBody(a.postData.params,d);u.push(v+" <- list("+y+")").blank();break;case contentType.JSON:i="json",v=u.var("body");y=objectToRString(a.postData.jsonObj,d);u.push(v+" = '"+y+"'").blank();break;case contentType.FORM_DATA:i="multipart",v=u.var("body");y=postDataToRListBody(a.postData.params,d);u.push(v+" <- list("+y+")").blank();break;default:(null===(o=a.postData)||void 0===o?void 0:o.text)&&(v=u.var("body"),i="raw",u.push(v+" = "+objectToRString(null===(n=a.postData)||void 0===n?void 0:n.text)).blank())}printUrlVariablesDeclarations(a,u),Object.keys(__assign(__assign({},a.pathParameters),a.serverVariables)).length&&u.blank().push("# create you own operator").push('"%&%" <- function(x, y)paste0(x,y)').blank();var _=buildUrlExpression(a,u);u.push("url = "+_).blank();var f=u.var("data_req");if(u.push(f+" <- "+h+"("),u.push(indent,"url,"),a.basicAuth){var k=a.basicAuth,T=k.username,D=k.password;u.push(indent,'authenticate("'+T+'", "'+D+'")')}if(Object.keys(a.allHeaders).length){var g=""+Object.keys(a.allHeaders).map((function(e){return'"'+e+'" = '+(a.allHeaders[e].startsWith("paste")?a.allHeaders[e]:'"'+a.allHeaders[e]+'"')})).join(", ");g&&u.push(indent,"add_headers("+g+"),")}return v&&(u.push(indent,"body = "+v+","),u.push(indent,'encode = "'+i+'",')),u.push(indent,"verbose()"),u.push(")"),d.printBody&&u.blank().push("content("+f+("raw"===i?', "text"':"")+")"),u.join()};export default handler;
//# sourceMappingURL=httr.js.map