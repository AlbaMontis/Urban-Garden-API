"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SecurityRow=exports.SecurityRequirements=exports.AUTH_TYPES=void 0;var tslib_1=require("tslib"),react_1=(0,tslib_1.__importStar)(require("react")),styled_components_1=(0,tslib_1.__importDefault)(require("../../styled-components")),styled_elements_1=require("../Markdown/styled.elements"),StoreBuilder_1=require("../StoreBuilder"),Markdown_1=require("../Markdown/Markdown"),utils_1=require("../../utils"),SecuritySchemes_1=require("../SecuritySchemes/SecuritySchemes"),Labels_1=require("../../services/Labels"),Panel_1=require("../../../../components/Panel"),SecurityRequirementPanelDescription_1=require("./SecurityRequirementPanelDescription"),SecurityRequirementElement_1=require("./SecurityRequirementElement"),RequiredScopesRow_1=require("./RequiredScopesRow");function getRequiredScopes(e,t){for(var r=[],n=t.length;n--;)for(var a=t[n],l=a.schemes.length;l--;){var c=a.schemes[l];c.id===e&&r.push.apply(r,c.scopes)}return Array.from(new Set(r))}exports.AUTH_TYPES={oauth2:"OAuth2",apiKey:"API Key",http:"HTTP",openIdConnect:"OpenID Connect"};var SecurityRequirements=function(e){var t=e.securities,r=(0,StoreBuilder_1.useStore)(),n=null==r?void 0:r.options.showSecuritySchemeType,a=(0,react_1.useState)(!1),l=a[0],c=a[1];if(!t.length)return null;var i=null==r?void 0:r.definition.securitySchemes.schemes,o=null==i?void 0:i.filter((function(e){var r=e.id;return t.find((function(e){return e.schemes.find((function(e){return e.id===r}))}))}));return react_1.default.createElement(Panel_1.ContentPanel,{header:(0,Labels_1.l)("authorizations"),onToggle:function(e){return c(e)},description:!l&&react_1.default.createElement(SecurityRequirementPanelDescription_1.SecurityRequirementPanelDescription,{securities:t,showSecuritySchemeType:n}),expanded:l},l&&o&&o.length>1?react_1.default.createElement(SecurityRequirementBlock,null,t.map((function(e,r){var a,l,c="";return t.length>1&&e.schemes.length>1&&(l=0===r?"(":"",c=")"),r!==t.length-1&&(c+=" or",a=react_1.default.createElement("br",null)),react_1.default.createElement(react_1.default.Fragment,{key:r},l,react_1.default.createElement(SecurityRequirementElement_1.SecurityRequirementElement,{key:r,security:e,showSecuritySchemeType:n}),c,a)}))):null,l&&o?o.map((function(e,r){var n=getRequiredScopes(e.id,t),a=react_1.default.createElement(RequiredScopesRow_1.RequiredScopesRow,{scopes:n});return react_1.default.createElement(SecurityDetails,{key:r},react_1.default.createElement("h5",null,react_1.default.createElement(LockIcon,null)," ",exports.AUTH_TYPES[e.type]||e.type,": ",e.id),react_1.default.createElement(Markdown_1.Markdown,{source:e.description||""}),react_1.default.createElement(styled_elements_1.StyledMarkdownBlock,{key:e.id},e.apiKey?react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement(exports.SecurityRow,null,react_1.default.createElement("b",null,(0,utils_1.titleize)(e.apiKey.in||"")," parameter name: "),react_1.default.createElement("code",null,e.apiKey.name)),a):e.http?react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement(exports.SecurityRow,null,react_1.default.createElement("b",null,"HTTP Authorization Scheme: "),react_1.default.createElement("code",null,e.http.scheme)),react_1.default.createElement(exports.SecurityRow,null,"bearer"===e.http.scheme&&e.http.bearerFormat&&react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement("b",null,"Bearer format: "),react_1.default.createElement("code",null,e.http.bearerFormat))),a):e.openId?react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement(exports.SecurityRow,null,react_1.default.createElement("b",null,"Connect URL: "),react_1.default.createElement("code",null,react_1.default.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:e.openId.connectUrl},e.openId.connectUrl))),a):e.flows?Object.keys(e.flows).map((function(t){return react_1.default.createElement(SecuritySchemes_1.OAuthFlow,{key:t,type:t,RequiredScopes:a,flow:e.flows[t]})})):null))})):null)};exports.SecurityRequirements=SecurityRequirements;var templateObject_1,templateObject_2,templateObject_3,SecurityDetails=styled_components_1.default.div(templateObject_1||(templateObject_1=(0,tslib_1.__makeTemplateObject)(["\n  border-bottom: 1px solid ",";\n  margin-bottom: 1.5em;\n  padding-bottom: 0.7em;\n  &:last-child {\n    border-bottom: none;\n    margin-bottom: 0;\n    padding-bottom: 0;\n  }\n  h5 {\n    line-height: 1em;\n    margin: 0 0 0.6em;\n    font-size: ",";\n  }\n  .redoc-markdown p:first-child {\n    display: inline;\n  }\n"],["\n  border-bottom: 1px solid ",";\n  margin-bottom: 1.5em;\n  padding-bottom: 0.7em;\n  &:last-child {\n    border-bottom: none;\n    margin-bottom: 0;\n    padding-bottom: 0;\n  }\n  h5 {\n    line-height: 1em;\n    margin: 0 0 0.6em;\n    font-size: ",";\n  }\n  .redoc-markdown p:first-child {\n    display: inline;\n  }\n"])),(function(e){return e.theme.colors.border.light}),(function(e){return e.theme.typography.fontSize})),SecurityRequirementBlock=styled_components_1.default.div(templateObject_2||(templateObject_2=(0,tslib_1.__makeTemplateObject)(["\n  margin-bottom: 20px;\n  background-color: ",";\n  border-radius: ",";\n  padding: ",";\n"],["\n  margin-bottom: 20px;\n  background-color: ",";\n  border-radius: ",";\n  padding: ",";\n"])),(function(e){return e.theme.colors.secondary.main}),(function(e){return e.theme.shape.borderRadius}),(function(e){var t=e.theme;return t.sidebar.spacing.unit+"px "+1.2*t.sidebar.spacing.unit+"px"})),LockIcon=function(){return react_1.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"11",height:"11"},react_1.default.createElement("path",{fill:"currentColor",d:"M18 10V6A6 6 0 0 0 6 6v4H3v14h18V10h-3zM8 6c0-2.206 1.794-4 4-4s4 1.794 4 4v4H8V6zm11 16H5V12h14v10z"}))};exports.SecurityRow=styled_components_1.default.div(templateObject_3||(templateObject_3=(0,tslib_1.__makeTemplateObject)(["\n  margin: 0.5em 0;\n"],["\n  margin: 0.5em 0;\n"])));
//# sourceMappingURL=SecurityRequirement.js.map